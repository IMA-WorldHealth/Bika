<html>
    <head>
        <title>USER PERMISSION</title>
        
        <link rel="stylesheet" href="./js/dojoos/dijit/themes/claro/claro.css" media="screen"/>
        <link rel="stylesheet" href="./js/dojoos/gridx/resources/claro/Gridx.css"/> 
        <link rel = "stylesheet" type = "text/css" href="../css/userPermission.css" media="screen" />
        <script>
        var roleGrid;
        require(["customizedModule/SelectX",
         	"customizedModule/CheckBoxX",
           "dojo/store/JsonRest",
           "dijit/form/TextBox",
           "dijit/form/CheckBox",
           "dijit/form/Button",
           "dijit/form/Form",
           "dojo/on",
           "dojo/Deferred",
           "dojo/promise/all",
           "gridx/core/model/cache/Async",
           "gridx/modules/SingleSort",
           "gridx/modules/extendedSelect/Row",
           "gridx/modules/CellWidget",
           "gridx/Grid",
           "dojo/topic",
           "dojo/domReady!"
           ], function (SelectX, CheckBoxX, JsonRest,TextBox,CheckBox, Button, Form, on, Deferred, all, Cache, SingleSort, Row, CellWidget, Grid, topic){
           	//declarations des variables
           	var bValider, bAnnuler, txtFirstName, txtLastName, txtEmail,
           	 txtUserName, txtPassWord, txtConformPassWord, chkAdmin, chkAdministrator,
              chkFinance, chkManager, chkDocteur, roleStore,
               userGrid, userStore, roleGridQuery = {}, userGridQuery = {};

           	  //creations champs des saisies
           	txtFirstName = new TextBox({class:"saisie", style:"width:220px;"},"firstnameID");
           	txtLastName = new TextBox({class:"saisie", style:"width:220px;"},"lastnameID");
           	txtEmail = new TextBox({class:"saisie", style:"width:220px;"},"emailID");
           	txtUserName = new TextBox({class:"saisie", style:"width:220px;"},"usernameID");
           	txtPassWord = new TextBox({class:"saisie", type:"password", style:"width:220px;"},"passwordID");
           	txtConformPassWord = new TextBox({class:"saisie", type:"password", style:"width:220px;"},"confirmpasswordID");

           	//creation des cases a caucher
            chkAdministrator = new CheckBox({value:'Administrator'},"chkadministratorID");
           	chkAdmin = new CheckBox({value:'Admin'},"chkadminID");
           	chkFinance = new CheckBox({value:'Finance'},"chkfinanceID");
           	chkManager = new CheckBox({value:'Manager'},"chkmanagerID");
           	chkDocteur = new CheckBox({value:'Docteur'},"chkdocteurID");

           	//creation des boutons
           	bValider = new Button({label:"Creer"}, "validerID");
           	bAnnuler = new Button({label:"Annuler"},"annulerID");
           	initUnitGrid();
            //initUserGrid();



           	//LES FONCTIONS
           function	initUnitGrid(){
            var hasWidget;
           	roleStore = new JsonRest({
                        target: 'data/'
                    });

                    var columns = [{
                        id: 'id',
                        field: 'id',
                        name: 'ID'
                    }, {
                        id: 'name',
                        field: 'name',
                        name: 'UNIT NAME'
                    }, {
                        id: 'description',
                        field: 'description',
                        name: 'UNIT DESCRIPTION'
                    },{
                      id:'etat',
                      name:'ETAT',
                      width:'35px',
                      widgetsInCell:true,
                      onCellWidgetCreated: function(CellWidget, column){
                        console.log("le cell est ", CellWidget); 
                        if(!hasWidget){
                          hasWidget = true;
                          var chk = new CheckBox({checked:false}).placeAt(CellWidget.domNode);                         
                          CellWidget.chk = chk;
                           on(chkAdministrator, "change", function(item){
                            var value = chkAdministrator.get('checked');
                            CellWidget.chk.set('checked', value);
                          });
                        }else{
                          hasWidget = false;                         
                        }

                      },
                      setCellValue: function(gridData, storData, CellWidget){
                        var value = (gridData)?true:false;
                        CellWidget.chk.set('checked', value);                       
                         
                      }
                    }];

                    var e = [{t : 'unit', c : ['id', 'name', 'desc']}];                    
                    roleGridQuery.e = e;
                    var requetteGrid = JSON.stringify(roleGridQuery);

                    roleGrid = new Grid({
                        style: "height:300px;",
                        cacheClass: Cache,
                        store: roleStore,
                        query: '?'+requetteGrid,
                        structure: columns,
                        selectRowTriggerOnCell: true,
                        modules: [
                            CellWidget,
                            SingleSort,
                            Row
                            ]
                    }, "divTabRole");            
            roleGrid.startup();	

           	}

             function initUserGrid(){
            userStore = new JsonRest({
                        target: 'data/'
                    });

                    var columns = [{
                        id: 'id',
                        field: 'id',
                        name: 'ID'
                    }, {
                        id: 'username',
                        field: 'username',
                        name: 'USER NAME'
                    }, {
                        id: 'email',
                        field: 'email',
                        name: 'EMAIL'
                    }];

                    var e = [{t : 'user', c : ['id', 'username', 'email']}];                    
                    userGridQuery.e = e;
                    var requetteGrid = JSON.stringify(userGridQuery);

                    userGrid = new Grid({
                        style: "height:240px;",
                        cacheClass: Cache,
                        store: userStore,
                        query: '?'+requetteGrid,
                        structure: columns,
                        selectRowTriggerOnCell: true,
                        modules: [
                            SingleSort,
                            ],
                    }, "sub");
            chkAdmin.startup();
            chkDocteur.startup();
            chkFinance.startup();
            chkManager.startup();
            chkAdministrator.startup();
            userGrid.startup(); 
            }
        });
        </script>      
         

    </head>
    <body class = "claro">
     <div id="principal">
     	<div id="divForm">
     	    <form id="newuserformID">
	            <div><label><b>First Name :</b></label><div class="saisie" id="firstnameID"></div></div>
	            <br/>
	            <div><label><b>Last Name :</b></label><div class="saisie" id="lastnameID"></div></div>
	            <br/>
	            <div><label><b>Email :</b></label><div class="saisie" id="emailID"></div></div>
	            <br/>
	            <span id="spanbademailID"><div id="bademailID"></div></span>
	            <br/>
	            <div><label><b>User Name :</b></label><div  class="saisie" id="usernameID"></div></div>
	            <br/> 
	            <div><label><b>Password :</b></label><div class="saisie" id="passwordID"></div></div>
	            <br/>
	            <div><label><b>Confirm Password :</b></label><div class="saisie" id="confirmpasswordID"></div></div>
	            <br/>
              <span id="spanbadpasswordID"><div id="badpasswordID"></div></span><br/>
	            <div id="roleID"><div id="chkadministratorID"></div><b>Administrator </b>	            
	            <br/>  </div>              
	            <div><div id="validerID"></div><div id="annulerID"></div></div>
          </form>     		
     	</div>

     	<div id="divTabRole">
     		
     	</div>
    </div>
    <div id="sub">
      
    </div>
    
     </body>
</html>   

